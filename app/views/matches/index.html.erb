<!-- Match Results Page -->
<div class="max-w-lg md:max-w-3xl lg:max-w-5xl mx-auto px-4 md:px-6 py-6">
  <div class="animate-fade-in-up">
    <!-- Header -->
    <div class="text-center mb-6">
      <h1 class="text-lg md:text-xl lg:text-2xl font-bold text-gray-800 flex items-center justify-center gap-2">
        <i class="fa-solid fa-users text-sky-500"></i>
        เพื่อนที่ Match กับคุณ
      </h1>
      <p class="text-xs text-gray-400 mt-1">
        ค้นหาเพื่อนที่เก่ง <span class="font-medium text-sky-500"><%= current_user.weak_subject || "—" %></span>
      </p>
    </div>

    <!-- Results -->
    <% if @matches.any? %>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
        <% @matches.each_with_index do |match, i| %>
          <%
            score = 70
            score += 15 if match.strong_subject == current_user.weak_subject
            score += 10 if match.study_style == current_user.study_style
            score += 5 if match.available_time == current_user.available_time
            score = [score, 99].min
          %>
          <div class="bg-white border border-gray-100 shadow-sm rounded-3xl p-5 relative overflow-hidden animate-card-pop hover:shadow-md transition-all" style="animation-delay: <%= i * 0.08 %>s">
            <div class="relative z-10">
              <!-- Profile Header -->
              <div class="flex flex-col items-center text-center mb-4">
                <!-- DiceBear Anonymous Avatar -->
                <div class="w-20 h-20 bg-white rounded-full mb-3 border-4 border-white shadow-md overflow-hidden">
                  <img src="https://api.dicebear.com/9.x/shapes/svg?seed=<%= match.faculty %><%= match.id %>&backgroundColor=f1f5f9" alt="Avatar" class="w-full h-full object-cover">
                </div>
                <h3 class="text-base font-bold text-gray-800 leading-tight">สมาชิกคณะ<%= match.faculty %></h3>

                <div class="flex items-center gap-3 mt-1 mb-2 text-xs">
                  <!-- Score Badge -->
                  <span class="inline-flex items-center gap-1 bg-green-100 text-green-700 px-2.5 py-1 rounded-full text-xs font-semibold border border-green-200">
                    <i class="fa-solid fa-check-circle"></i> <%= score %>%
                  </span>
                  <!-- Star Rating (simulated) -->
                  <span class="bg-yellow-50 text-yellow-700 px-2 py-0.5 rounded-md border border-yellow-100 flex items-center gap-1">
                    <i class="fa-solid fa-star text-yellow-400"></i> <%= (4.0 + (match.id % 10) * 0.1).round(1) %>
                  </span>
                </div>

                <p class="text-sky-600 font-medium text-xs bg-sky-50 inline-block px-2 py-1 rounded-lg">
                  <i class="fa-solid fa-building text-sky-400 mr-1"></i>คณะ<%= match.faculty %>
                </p>
              </div>

              <!-- Skill Grid -->
              <div class="grid grid-cols-2 gap-3 mb-4">
                <div class="bg-green-50 p-3 rounded-2xl border border-green-100 text-center">
                  <p class="text-[10px] text-gray-400 uppercase font-medium mb-1">สอนได้</p>
                  <p class="font-bold text-green-700 text-xs break-words"><%= match.strong_subject %></p>
                </div>
                <div class="bg-red-50 p-3 rounded-2xl border border-red-100 text-center">
                  <p class="text-[10px] text-gray-400 uppercase font-medium mb-1">อยากให้ช่วย</p>
                  <p class="font-bold text-red-700 text-xs break-words"><%= match.weak_subject %></p>
                </div>
              </div>

              <!-- Tags -->
              <div class="flex flex-wrap justify-center gap-1.5 mb-4">
                <% if match.study_style.present? %>
                  <span class="px-3 py-1 bg-gray-100 rounded-full text-[10px] text-gray-600 border border-gray-200 flex items-center gap-1">
                    <i class="fa-solid fa-mug-hot text-sky-500"></i> <%= match.study_style&.truncate(20) %>
                  </span>
                <% end %>
                <% if match.available_time.present? %>
                  <span class="px-3 py-1 bg-gray-100 rounded-full text-[10px] text-gray-600 border border-gray-200 flex items-center gap-1">
                    <i class="fa-regular fa-clock text-sky-500"></i> <%= match.available_time %>
                  </span>
                <% end %>
              </div>

              <!-- Actions -->
              <div class="space-y-2">
                <%= button_to start_chat_match_path(match), method: :post, class: "w-full py-2.5 bg-sky-600 hover:bg-sky-700 text-white font-bold rounded-xl shadow-lg shadow-sky-500/20 active:scale-95 transition-all flex items-center justify-center gap-2 text-sm" do %>
                  <i class="fa-solid fa-comment"></i>
                  ทักแชทเลย
                <% end %>

                <%= button_to icebreaker_match_path(match), method: :post, class: "w-full py-2.5 bg-indigo-50 hover:bg-indigo-100 text-indigo-600 font-medium rounded-xl transition-colors text-xs flex items-center justify-center gap-1.5 border border-indigo-100", data: { turbo: true } do %>
                  <i class="fa-solid fa-wand-magic-sparkles"></i>
                  ✨ AI แนะนำบทสนทนา
                <% end %>
              </div>

              <!-- Icebreaker Result -->
              <div id="icebreaker_<%= match.id %>" class="mt-3"></div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Search Again -->
      <div class="text-center mt-6">
        <%= link_to edit_profile_path, class: "text-sm text-gray-400 hover:text-sky-500 transition-colors inline-flex items-center gap-1.5" do %>
          <i class="fa-solid fa-gear"></i>
          แก้ไขเงื่อนไข
        <% end %>
      </div>
    <% else %>
      <!-- Empty State -->
      <div class="bg-white rounded-2xl border border-gray-100 shadow-sm p-12 text-center max-w-md mx-auto">
        <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-5 animate-float">
          <i class="fa-solid fa-ghost text-gray-300 text-3xl"></i>
        </div>
        <h3 class="text-lg font-bold text-gray-800">ยังไม่เจอคู่ที่เป๊ะเลย...</h3>
        <p class="text-gray-500 mt-2 text-sm font-light px-4">ลองเปลี่ยนเวลา หรือวิชาดูไหม? <br>อาจจะมีคนรอติววิชาอื่นอยู่ก็ได้นะ</p>
        <div class="mt-6">
          <%= link_to edit_profile_path, class: "inline-flex items-center gap-2 px-6 py-3 bg-sky-500 hover:bg-sky-600 text-white rounded-xl text-sm font-medium transition-colors shadow-lg shadow-sky-500/20 active:scale-95" do %>
            <i class="fa-solid fa-pen"></i>
            แก้ไขโปรไฟล์
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
